// Set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 40},
    width = 800 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// Append the SVG object to the body of the page
var svg = d3.select("body")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Locations of the regions
var foci = {
    "APAC": {x: 100, y: 200},
    "EMEA": {x: 350, y: 200},
    "AMER": {x: 600, y: 200}
};

// Colors of the regions
var colors = {
    "APAC": "lightgrey",
    "EMEA": "red",
    "AMER": "darkgrey"
};

// Load the data
d3.json("data.js").then(function(data) {
    // Create a node for each city
    var nodes = data.map(function(d, i) {
        return {
            id: i,
            city: d["Requested By Location"],
            region: d["Assigned to Region"],
            x: Math.random() * width,
            y: Math.random() * height
        };
    });

    // Create a force simulation
    var simulation = d3.forceSimulation(nodes)
        .force("x", d3.forceX(function(d) { return foci[d.region].x; }).strength(0.2))
        .force("y", d3.forceY(function(d) { return foci[d.region].y; }).strength(0.2))
        .force("collide", d3.forceCollide(10));

    // Create SVG circles for each city
    var circles = svg.selectAll("circle")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("r", 5) // Radius of the bubbles
        .attr("fill", function(d) { return colors[d.region]; });

    // Update the positions of the circles on each tick of the simulation
    simulation.on("tick", function() {
        circles
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; });
    });
});
