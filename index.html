<!DOCTYPE html>
<meta charset="utf-8">

<!-- Import D3.js -->
<script src="https://d3js.org/d3.v6.min.js"></script>

<body>
<!-- Add speed control buttons -->
<button onclick="setDelay(1000)">Slow</button>
<button onclick="setDelay(500)">Medium</button>
<button onclick="setDelay(100)">Fast</button>

<script>
// Set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 40},
    width = 800 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// Append the SVG object to the body of the page
var svg = d3.select("body")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Locations of the regions
var foci = {
    "APAC": {x: 100, y: 200},
    "EMEA": {x: 350, y: 200},
    "AMER": {x: 600, y: 200}
};

// Colors of the regions
var colors = {
    "APAC": "lightgrey",
    "EMEA": "red",
    "AMER": "darkgrey"
};

// Create a global delay variable for the animation speed
var delay = 1000;

// Create a function to set the delay
function setDelay(newDelay) {
    delay = newDelay;
}

// Load the data
d3.json("data.js").then(function(data) {
    // Create a node for each city
    var cityNodes = data.map(function(d, i) {
        return {
            id: i,
            city: d["Requested By Location"],
            region: d["Assigned to Region"],
            x: Math.cos(i / data.length * 2 * Math.PI) * width / 2 + width / 2,
            y: Math.sin(i / data.length * 2 * Math.PI) * height / 2 + height / 2
        };
    });

    // Create a node for each event
    var eventNodes = data.map(function(d, i) {
        return {
            id: i + data.length,
            city: d["Requested By Location"],
            region: d["Assigned to Region"],
            x: Math.cos(i / data.length * 2 * Math.PI) * width / 2 + width / 2,
            y: Math.sin(i / data.length * 2 * Math.PI) * height / 2 + height / 2
        };
    });

    // Create SVG circles for each city
    var cityCircles = svg.selectAll(".city")
        .data(cityNodes)
        .join("circle")
        .attr("class", "city")
        .attr("r", 5) // Radius of the bubbles
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        .attr("fill", "black");

    // Create SVG circles for each event
    var eventCircles = svg.selectAll(".event")
        .data(eventNodes)
        .join("circle")
        .attr("class", "event")
        .attr("r", 5) // Radius of the bubbles
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        .attr("fill", function(d) { return colors[d.region]; });

    // Animate the events
    eventCircles
        .transition()
        .delay(function(d, i) { return i * delay; })
        .duration(1000)
        .attr("cx", function(d) { return foci[d.region].x; })
        .attr("cy", function(d) { return foci[d.region].y; });
});
</script>
</body>
</html>
