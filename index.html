<!DOCTYPE html>
<meta charset="utf-8">

<!-- Import D3.js -->
<script src="https://d3js.org/d3.v6.min.js"></script>

<body>
<!-- Add speed control buttons -->
<button onclick="setDelay(1000)">Slow</button>
<button onclick="setDelay(500)">Medium</button>
<button onclick="setDelay(100)">Fast</button>

<script>
// Set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 40},
    width = 800 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// Append the SVG object to the body of the page
var svg = d3.select("body")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Locations of the regions
var foci = {
    "APAC": {x: 100, y: 200},
    "EMEA": {x: 350, y: 200},
    "AMER": {x: 600, y: 200}
};

// Colors of the regions
var colors = {
    "APAC": "lightgrey",
    "EMEA": "red",
    "AMER": "darkgrey"
};

// Load the data
d3.json("data.js").then(function(data) {
    // Create a node for each city
    var nodes = data.map(function(d, i) {
        var angle = (i / data.length) * 2 * Math.PI;
        var edgeX = width / 2 + (width / 2 - 50) * Math.cos(angle);
        var edgeY = height / 2 + (height / 2 - 50) * Math.sin(angle);
        return {
            id: i,
            city: d["Requested By Location"],
            region: d["Assigned to Region"],
            x: edgeX,
            y: edgeY
        };
    });

    // Create a force simulation
    var simulation = d3.forceSimulation(nodes)
        .force("x", d3.forceX(function(d) { return foci[d.region].x; }).strength(0.2))
        .force("y", d3.forceY(function(d) { return foci[d.region].y; }).strength(0.2))
        .force("collide", d3.forceCollide(10));

    // Create SVG circles for each city
    var circles = svg.selectAll("circle")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("r", 5) // Radius of the bubbles
        .attr("fill", "black");

    // Create SVG text for each city
    var labels = svg.selectAll("text")
        .data(nodes)
        .enter()
        .append("text")
        .attr("dx", function(d) { return d.x; })
        .attr("dy", function(d) { return d.y - 10; }) // Offset the labels above the bubbles
        .text(function(d) { return d.city; });

    // Create SVG circles for each request
    var requests = svg.selectAll(".request")
        .data(nodes) // Use the same data as the cities for simplicity
        .enter()
        .append("circle")
        .classed("request", true)
        .attr("r", 3) // Radius of the bubbles
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        .attr("fill", function(d) { return colors[d.region]; });

    // Update the positions of the circles on each tick of the simulation
    simulation.on("tick", function() {
        circles
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; });
        labels
            .attr("dx", function(d) { return d.x; })
            .attr("dy", function(d) { return d.y - 10; });
        requests
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; });
    });
});
</script>
</body>
</html>
